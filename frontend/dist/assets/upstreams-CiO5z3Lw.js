import{_ as re,a as ie,b as me,D as ue,R as de,d as pe,S as ce,c as _e}from"./index-fvitOmZ4.js";import{d as fe,K as ge,r as m,L as I,F as ve,M as $,c as n,U as N,N as o,O as K,i as he,Q as c,R as u,S as d,T as i,V as r,a7 as ye,a8 as g,a9 as S,aa as be,ab as we,ac as ke,$ as Ce}from"./index-sY8U2mN5.js";import{B as xe,_ as $e}from"./index-DF6QHY1m.js";import{I as Se}from"./index-CuhAjkvG.js";import{S as Oe}from"./SearchOutlined-BLCZb9-5.js";import{B as Ue,P as Re}from"./Col-CfXYHSRU.js";import{F as Fe,_ as De,a as Be}from"./TextArea-eBr-9_0I.js";import{S as Ie}from"./StarFilled-Tv6iLqbj.js";import{_ as Ke,a as qe,b as Pe}from"./index-ByZ25-ct.js";import{P as Te,D as Me}from"./PlusCircleFilled-DVCoVN4Q.js";import{_ as Ne}from"./index-BCEZO0Ve.js";const Ve={style:{padding:"24px",minHeight:"calc(100vh - 110px)",width:"100%"},class:"charmful"},je={key:1},He={href:"https://nginx.org/en/docs/http/ngx_http_upstream_module.html",target:"_blank"},ze=fe({__name:"upstreams",setup(Ae){const{t:l}=ge(),O=he("$http"),f=m(""),v=m([]),U=m([]),R=m(!1),h=m(!1),y=m(),F=m(""),V=m([{label:l("upstreams.roundRobin"),value:""},{label:l("upstreams.ipHash"),value:"ip_hash"},{label:l("upstreams.leastConn"),value:"least_conn"}]),b=I({selectedRowKeys:[]}),j=I({showSizeChanger:!0,showQuickJumper:!0,pageSizeOptions:["10","20","50"],showTotal:e=>l("common.showTotal",{total:e})}),q={id:0,name:"",method:"ip_hash",servers:[],config:`ip_hash;
server 127.0.0.1:8080;
server www.example:8081;
keepalive 320;
keepalive_requests 1000;`},a=I({...q}),H={name:[{required:!0,message:l("common.required"),trigger:"change",transform(e){return e.trim()}}],config:[{required:!0,message:l("common.required"),trigger:"change",transform(e){return e.trim()}}]},z=[{title:"ID",dataIndex:"id",width:"8%",ellipsis:!0},{title:l("common.name"),dataIndex:"name",width:"15%",ellipsis:!0},{title:l("upstreams.config"),dataIndex:"config",ellipsis:!0},{title:l("common.updatedAt"),dataIndex:"updated_at",width:"15%",ellipsis:!0},{key:"action",title:l("common.setting"),width:"10%",align:"center",ellipsis:!0}],A=e=>{b.selectedRowKeys=e},P=e=>{e?(F.value=l("upstreams.setUpstream"),a.id=e.id,a.name=e.name,a.config=e.config):(F.value=l("upstreams.addUpstream"),Object.assign(a,q),a.servers=[{id:Date.now(),addr:"127.0.0.1:8080"},{id:Date.now()+1,addr:"www.example:8081"}]),h.value=!0},L=()=>{a.servers.push({id:Date.now(),addr:"127.0.0.1:8080"}),w()},Q=e=>{const t=a.servers.indexOf(e);t!==-1&&a.servers.splice(t,1),w()},w=()=>{let e=a.method===""?"":a.method+`;
`;a.config=e+a.servers.map(t=>"server "+t.addr.trim()+";").join(`
`)+`
keepalive 320;
keepalive_requests 1000;`},E=e=>{if(e.length===0){c.warn(l("common.delSelected"));return}O({url:"/admin/upstreams",method:"delete",data:{keys:e}}).then(t=>{t.error?c.error(t.error):(b.selectedRowKeys=[],c.success(l("common.delOk")),k(!1))}).catch(t=>{console.log("error",t)})},k=e=>{R.value=!0,O.get("/admin/upstreams").then(t=>{t.error?c.error(t.error):(v.value=t,U.value=t,e&&c.success(l("common.refreshOk"))),R.value=!1})},J=()=>{y.value.validate().then(()=>{O({url:"/admin/upstreams",method:a.id===0?"POST":"PUT",data:a}).then(e=>{e.error?c.error(e.error):(c.success(l("common.submitOk")),y.value.resetFields(),k(!1),h.value=!1)}).catch(e=>{console.log("error",e)})}).catch(e=>{console.log("error",e)})},G=()=>{y.value.resetFields()},W=()=>{f.value!=""?v.value=U.value.filter(e=>e.name.match(f.value)||e.config.match(f.value)):v.value=U.value};return ve(()=>{k(!1)}),(e,t)=>{const T=$e,X=xe,D=Se,B=qe,p=Ue,M=ye,Y=me,Z=Ke,ee=re,_=De,te=Ne,ne=Pe,oe=_e,ae=Be,se=Fe,le=ie;return u(),$(K,null,[n(X,{style:{margin:"16px 0"}},{default:o(()=>[n(T,null,{default:o(()=>[d(i(e.$t("common.navigation")),1)]),_:1}),n(T,null,{default:o(()=>[d(i(e.$t("menu.upstreams")),1)]),_:1})]),_:1}),N("div",Ve,[n(Z,{style:{"margin-bottom":"10px"}},{default:o(()=>[n(B,{flex:"200px"},{default:o(()=>[n(D,{value:f.value,"onUpdate:value":t[0]||(t[0]=s=>f.value=s),name:"search",placeholder:e.$t("common.search"),onChange:W},{addonAfter:o(()=>[n(r(Oe),{style:{color:"#00b96b"}})]),_:1},8,["value","placeholder"])]),_:1}),n(B,{flex:"auto"}),n(B,{flex:"120px"},{default:o(()=>[n(M,null,{title:o(()=>[d(i(e.$t("common.new")),1)]),default:o(()=>[n(p,{type:"primary",shape:"circle",onClick:t[1]||(t[1]=s=>P(null))},{icon:o(()=>[n(r(Re))]),_:1})]),_:1}),n(Y,{title:e.$t("common.delConfirm"),"ok-text":e.$t("common.ok"),"cancel-text":e.$t("common.cancel"),onConfirm:t[2]||(t[2]=s=>E(b.selectedRowKeys))},{default:o(()=>[n(p,{type:"primary",shape:"circle",style:{"margin-left":"10px"},danger:""},{icon:o(()=>[n(r(ue))]),_:1})]),_:1},8,["title","ok-text","cancel-text"]),n(M,null,{title:o(()=>[d(i(e.$t("common.refresh")),1)]),default:o(()=>[n(p,{type:"primary",shape:"circle",style:{"margin-left":"10px"},onClick:t[3]||(t[3]=s=>k(!0))},{icon:o(()=>[n(r(de))]),_:1})]),_:1})]),_:1})]),_:1}),n(ee,{dataSource:v.value,columns:z,pagination:j,loading:R.value,rowSelection:{selectedRowKeys:b.selectedRowKeys,onChange:A},rowKey:s=>s.id},{bodyCell:o(({column:s,record:C})=>[s.dataIndex==="updated_at"?(u(),$(K,{key:0},[d(i(r(pe)(C.updated_at,"yyyy-MM-dd HH:mm:ss")),1)],64)):s.key==="action"?(u(),$("span",je,[n(p,{type:"primary",shape:"circle",onClick:x=>P(C)},{icon:o(()=>[n(r(ce))]),_:2},1032,["onClick"])])):g("",!0)]),_:1},8,["dataSource","pagination","loading","rowSelection","rowKey"]),n(le,{open:h.value,"onUpdate:open":t[11]||(t[11]=s=>h.value=s),title:F.value,width:"560px",closable:!1},{default:o(()=>[n(se,{layout:"vertical",ref_key:"formRef",ref:y,model:a,rules:H},{default:o(()=>[n(_,{label:e.$t("common.name"),"has-feedback":"",name:"name"},{default:o(()=>[n(D,{value:a.name,"onUpdate:value":t[4]||(t[4]=s=>a.name=s),placeholder:""},{addonBefore:o(()=>[n(r(Ie),{style:{color:"#00b96b"}})]),_:1},8,["value"])]),_:1},8,["label"]),n(te,{message:e.$t("upstreams.info"),type:"info","show-icon":"",style:{margin:"10px 0"}},{action:o(()=>[N("a",He,i(e.$t("common.more")),1)]),_:1},8,["message"]),a.id===0?(u(),S(_,{key:0,label:e.$t("upstreams.method"),name:"method"},{default:o(()=>[n(ne,{value:a.method,"onUpdate:value":t[5]||(t[5]=s=>a.method=s),options:V.value,onSelect:t[6]||(t[6]=s=>w())},null,8,["value","options"])]),_:1},8,["label"])):g("",!0),a.id===0?(u(!0),$(K,{key:1},be(a.servers,(s,C)=>(u(),S(oe,{key:s.id,style:{display:"flex","align-items":"center","justify-content":"space-between",border:"1px solid rgb(0 185 107 / 17%)","border-radius":"5px",padding:"10px","margin-bottom":"10px","background-color":"rgb(140 255 170 / 11%)"},align:"baseline"},{default:o(()=>[n(_,{name:["servers",C,"addr"]},{default:o(()=>[n(D,{value:s.addr,"onUpdate:value":x=>s.addr=x,style:{width:"420px"},onChange:t[7]||(t[7]=x=>w())},null,8,["value","onUpdate:value"])]),_:2},1032,["name"]),a.servers.length>1?(u(),S(r(Me),{key:0,onClick:x=>Q(s),class:"dynamic-delete-button"},null,8,["onClick"])):g("",!0)]),_:2},1024))),128)):g("",!0),a.id===0?(u(),S(_,{key:2},{default:o(()=>[n(p,{type:"dashed",block:"",onClick:L},{default:o(()=>[n(r(Te)),d(" "+i(e.$t("upstreams.addUpstreamBtn")),1)]),_:1})]),_:1})):g("",!0),n(_,{label:e.$t("upstreams.customConfig"),name:"config"},{default:o(()=>[n(ae,{value:a.config,"onUpdate:value":t[8]||(t[8]=s=>a.config=s),rows:5},null,8,["value"])]),_:1},8,["label"]),n(_,{style:{"text-align":"center","margin-top":"42px"}},{default:o(()=>[n(p,{type:"primary",shape:"round",onClick:t[9]||(t[9]=s=>J())},{icon:o(()=>[n(r(we))]),default:o(()=>[d(" "+i(e.$t("common.submit")),1)]),_:1}),n(p,{type:"primary",shape:"round",style:{"margin-left":"120px"},onClick:t[10]||(t[10]=s=>G())},{icon:o(()=>[n(r(ke))]),default:o(()=>[d(" "+i(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])],64)}}}),nt=Ce(ze,[["__scopeId","data-v-9ba539b3"]]);export{nt as default};
